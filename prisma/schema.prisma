// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  CLIENT
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String   // '?'ë¥¼ ì œê±°í•˜ì—¬ í•„ìˆ˜ê°’ìœ¼ë¡œ ë³€ê²½
  phone     String?  // ë³¸ì¸ì¸ì¦ ì‹œ ë°›ì•„ì˜¬ ì—°ë½ì²˜
  isVerified Boolean @default(false) // ì‹¤ëª…(ë³¸ì¸) ì¸ì¦ ì—¬ë¶€
  password  String
  role      Role     @default(CLIENT)
  createdAt DateTime @default(now())

  threads   Thread[]
  listings  Listing[]
  favorites Favorite[] // ì°œí•œ ë§¤ë¬¼ ëª©ë¡ (1:N)
}

model Listing {
  id             Int       @id @default(autoincrement())
  ownerId        String?
  owner          User?     @relation(fields: [ownerId], references: [id])
  description    String?
  title          String
  category       String
  address_area   String?
  address_full   String?   // ìƒì„¸ ì£¼ì†Œ ì¶”ê°€
  rent_monthly   Int?
  deposit        Int?
  goodwill_price Int?
  monthly_sales  Int?
  parking_spaces Int?
  
  // ìœ„ì¹˜ ì •ë³´
  lat            Float?
  lng            Float?

  // ì¸ì¦ ë° ì„œë¥˜ ê´€ë ¨ í•„ë“œ ì¶”ê°€
  isRevenueVerified       Boolean @default(false) // ë§¤ì¶œ ì¸ì¦
  isBuildingLedgerVerified Boolean @default(false) // ê±´ì¶•ë¬¼ëŒ€ì¥ ì¸ì¦
  isRegistryVerified      Boolean @default(false) // ë“±ê¸°ë¶€ë“±ë³¸ ì¸ì¦
  
  revenueProofUrl    String? // ë§¤ì¶œ ì¦ë¹™
  buildingLedgerUrl  String? // ê±´ì¶•ë¬¼ëŒ€ì¥ íŒŒì¼
  registryUrl        String? // ë“±ê¸°ë¶€ë“±ë³¸ íŒŒì¼

  photos         Json?
  createdAt      DateTime  @default(now())
  favoritedBy    Favorite[] // ì´ ë§¤ë¬¼ì„ ì°œí•œ ìœ ì € ëª©ë¡ (1:N)

  threads        Thread[]

  @@index([ownerId])
}

model Thread {
  id              String    @id @default(cuid())
  type            String
  title           String?
  listingId       Int?
  userId          String?
  createdAt       DateTime  @default(now())
  lastAdminReadAt DateTime?
  lastUserReadAt  DateTime?
  
  user     User?    @relation(fields: [userId], references: [id])
  listing  Listing? @relation(fields: [listingId], references: [id])
  messages Message[]
}

model Message {
  id       String   @id @default(cuid())
  threadId String
  from     String
  text     String
  at       DateTime @default(now())
  thread   Thread   @relation(fields: [threadId], references: [id], onDelete: Cascade)

  @@index([threadId, at])
}

model Lead {
  id        String   @id @default(cuid())
  type      String   
  listingId Int?
  name      String
  phone     String
  message   String?
  payload   Json?
  partnerId String?
  createdAt DateTime @default(now())
}

// ğŸ’¡ ì°œí•˜ê¸°(ê´€ì‹¬ ë§¤ë¬¼)ë¥¼ ìœ„í•œ ìƒˆë¡œìš´ í…Œì´ë¸” ì¶”ê°€
model Favorite {
  id        String   @id @default(cuid())
  userId    String
  listingId Int
  createdAt DateTime @default(now())

  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  listing   Listing  @relation(fields: [listingId], references: [id], onDelete: Cascade)

  // í•œ ìœ ì €ê°€ ê°™ì€ ë§¤ë¬¼ì„ ì¤‘ë³µí•´ì„œ ì°œí•  ìˆ˜ ì—†ë„ë¡ ê³ ìœ í‚¤ ì„¤ì •
  @@unique([userId, listingId])
  @@index([userId])
  @@index([listingId])
}