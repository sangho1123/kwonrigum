{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/sanghojeong/Desktop/Projects/%EA%B6%8C%EB%A6%AC%EA%B8%88%EC%A4%91%EA%B0%9C%EC%95%B1/my-shop-transfer-app-1.3/components/ListingMap.tsx"],"sourcesContent":["// components/ListingMap.tsx\n\"use client\";\n\nimport type { Listing } from \"@/lib/mockData\";\nimport { useEffect, useRef, useState } from \"react\";\n\ndeclare global {\n  interface Window {\n    naver: any;\n    navermap_authFailure?: () => void;\n  }\n}\n\n// ✅ Web JS v3: openapi + ncpClientId (동작 확인된 방식)\nconst NAVER_CLIENT_ID =\n  process.env.NEXT_PUBLIC_NAVER_MAP_CLIENT_ID ?? \"hdlzlfn5o0\";\n\nexport default function ListingMap({\n  items,\n  selectedId,\n  onSelect,\n}: {\n  items: Listing[];\n  selectedId?: number | null;\n  onSelect?: (id: number) => void;\n}) {\n  const mapRef = useRef<HTMLDivElement | null>(null);\n  const mapObj = useRef<any>(null);\n  const markersRef = useRef<Record<number, any>>({});\n  const [loaded, setLoaded] = useState(false);\n  const [authFailed, setAuthFailed] = useState(false);\n\n  // 인증 실패 콜백\n  useEffect(() => {\n    if (typeof window === \"undefined\") return;\n    window.navermap_authFailure = function () {\n      console.error(\"[NAVER MAP] Authentication Failed\");\n      setAuthFailed(true);\n    };\n  }, []);\n\n  // SDK 로드\n  useEffect(() => {\n    if (typeof window === \"undefined\") return;\n    if (window.naver?.maps) {\n      setLoaded(true);\n      return;\n    }\n    const id = \"naver-map-sdk\";\n    let s = document.getElementById(id) as HTMLScriptElement | null;\n    const src = `https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=${NAVER_CLIENT_ID}&_=${Date.now()}`;\n    if (!s) {\n      s = document.createElement(\"script\");\n      s.id = id;\n      s.async = true;\n      s.defer = true;\n      document.head.appendChild(s);\n    }\n    s.src = src;\n    s.onload = () => {\n      console.log(\"[NAVER MAP] SDK loaded\", { ncpClientId: NAVER_CLIENT_ID });\n      setLoaded(true);\n    };\n    s.onerror = () => console.error(\"[NAVER MAP] SDK load error\");\n  }, []);\n\n  // 지도/마커\n  useEffect(() => {\n    if (!loaded || !mapRef.current || !window.naver?.maps || authFailed) return;\n    const { naver } = window;\n\n    const first = items[0];\n    const center = first\n      ? new naver.maps.LatLng(first.lat, first.lng)\n      : new naver.maps.LatLng(37.5665, 126.9780);\n    const map = new naver.maps.Map(mapRef.current, {\n      center,\n      zoom: 13,\n      zoomControl: true,\n      zoomControlOptions: { position: naver.maps.Position.TOP_RIGHT },\n    });\n    mapObj.current = map;\n\n    // 기존 마커 제거\n    Object.values(markersRef.current).forEach((m) => m.setMap(null));\n    markersRef.current = {};\n\n    // 마커 생성\n    const bounds = new naver.maps.LatLngBounds();\n    items.forEach((it) => {\n      const pos = new naver.maps.LatLng(it.lat, it.lng);\n      bounds.extend(pos);\n\n      const marker = new naver.maps.Marker({\n        map,\n        position: pos,\n      });\n      markersRef.current[it.id] = marker;\n\n      naver.maps.Event.addListener(marker, \"click\", () => {\n        onSelect?.(it.id);\n        map.panTo(pos);\n      });\n    });\n\n    if (items.length > 1) {\n      map.fitBounds(bounds, { top: 20, left: 20, right: 20, bottom: 20 });\n    }\n  }, [loaded, authFailed, items, onSelect]);\n\n  // 선택된 마커로 포커스\n  useEffect(() => {\n    if (!selectedId || !mapObj.current || !window.naver?.maps) return;\n    const marker = markersRef.current[selectedId];\n    if (!marker) return;\n    const pos = marker.getPosition();\n    mapObj.current.panTo(pos);\n    try {\n      marker.setAnimation(window.naver.maps.Animation.BOUNCE);\n      setTimeout(() => marker.setAnimation(null), 700);\n    } catch {}\n  }, [selectedId]);\n\n  return (\n    <div className=\"relative w-full h-64 rounded-2xl border border-neutral-200 overflow-hidden\">\n      <div ref={mapRef} className=\"w-full h-full\" />\n      {!loaded && (\n        <div className=\"absolute inset-0 flex items-center justify-center text-sm\">\n          지도를 불러오는 중…\n        </div>\n      )}\n      {authFailed && (\n        <div className=\"absolute inset-0 bg-white/85 backdrop-blur flex items-center justify-center p-4 text-xs\">\n          <div className=\"text-center\">\n            <div className=\"text-red-600 font-semibold mb-1\">\n              네이버 지도 인증 실패\n            </div>\n            <div className=\"text-neutral-700\">\n              Web 서비스 URL / ncpClientId 설정을 확인하세요.\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 213, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/sanghojeong/Desktop/Projects/%EA%B6%8C%EB%A6%AC%EA%B8%88%EC%A4%91%EA%B0%9C%EC%95%B1/my-shop-transfer-app-1.3/components/LeadCtas.tsx"],"sourcesContent":["// components/LeadCtas.tsx\n\"use client\";\n\nimport { FormEvent, useState } from \"react\";\n\ntype LeadType = \"loan\" | \"fitout\" | \"closure\";\n\ntype Props = {\n  listingId: number;\n};\n\nexport default function LeadCtas({ listingId }: Props) {\n  const [activeType, setActiveType] = useState<LeadType | null>(null);\n  const [name, setName] = useState(\"\");\n  const [phone, setPhone] = useState(\"\");\n  const [message, setMessage] = useState(\"\");\n  const [loading, setLoading] = useState(false);\n  const [result, setResult] = useState<string | null>(null);\n  const [error, setError] = useState<string | null>(null);\n\n  const openForm = (type: LeadType) => {\n    setActiveType(type);\n    setResult(null);\n    setError(null);\n  };\n\n  const closeForm = () => {\n    setActiveType(null);\n    setLoading(false);\n    setError(null);\n    // 메시지/입력값은 그대로 둬도 되고, 필요하면 여기서 리셋해도 됨\n    // setName(\"\");\n    // setPhone(\"\");\n    // setMessage(\"\");\n  };\n\n  const labelByType: Record<LeadType, string> = {\n    loan: \"대출 상담\",\n    fitout: \"인테리어 상담\",\n    closure: \"임차/권리금 상담\",\n  };\n\n  const highlightClassByType: Record<LeadType, string> = {\n    loan: \"border-sky-200 bg-sky-50 text-sky-800\",\n    fitout: \"border-indigo-200 bg-indigo-50 text-indigo-800\",\n    closure: \"border-emerald-200 bg-emerald-50 text-emerald-800\",\n  };\n\n  const handleSubmit = async (e: FormEvent) => {\n    e.preventDefault();\n    if (!activeType) return;\n\n    if (!name.trim() || !phone.trim()) {\n      setError(\"이름과 연락처는 필수입니다.\");\n      setResult(null);\n      return;\n    }\n\n    setLoading(true);\n    setError(null);\n    setResult(null);\n\n    try {\n      const payload = {\n        source: \"listing-detail-inline-cta\",\n        displayTypeLabel: labelByType[activeType],\n        quickMessage: message || undefined,\n      };\n\n      const res = await fetch(\"/api/leads\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          type: activeType,\n          listingId,\n          name: name.trim(),\n          phone: phone.trim(),\n          message: message || undefined,\n          payload,\n        }),\n      });\n\n      const data = await res.json();\n      if (!res.ok || !data?.ok) {\n        throw new Error(data?.error || \"전송에 실패했습니다.\");\n      }\n\n      setResult(\"상담 요청이 접수되었습니다. 파트너가 확인 후 연락드립니다.\");\n      setError(null);\n      // 필요하면 자동으로 폼 닫기\n      // closeForm();\n    } catch (e: any) {\n      setError(e?.message || \"전송 중 오류가 발생했습니다.\");\n      setResult(null);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"space-y-3\">\n      {/* CTA 버튼 3종 */}\n      <div className=\"grid grid-cols-3 gap-2\">\n        <button\n          type=\"button\"\n          onClick={() => openForm(\"loan\")}\n          className={`rounded-xl border px-3 py-2 text-xs font-medium text-center hover:bg-sky-50 ${\n            activeType === \"loan\" ? highlightClassByType[\"loan\"] : \"bg-white\"\n          }`}\n        >\n          대출 상담\n          <div className=\"mt-0.5 text-[10px] text-neutral-500\">\n            보증금/권리금/인테리어 대출\n          </div>\n        </button>\n\n        <button\n          type=\"button\"\n          onClick={() => openForm(\"fitout\")}\n          className={`rounded-xl border px-3 py-2 text-xs font-medium text-center hover:bg-indigo-50 ${\n            activeType === \"fitout\" ? highlightClassByType[\"fitout\"] : \"bg-white\"\n          }`}\n        >\n          인테리어 상담\n          <div className=\"mt-0.5 text-[10px] text-neutral-500\">\n            공사 견적·시공 일정\n          </div>\n        </button>\n\n        <button\n          type=\"button\"\n          onClick={() => openForm(\"closure\")}\n          className={`rounded-xl border px-3 py-2 text-xs font-medium text-center hover:bg-emerald-50 ${\n            activeType === \"closure\" ? highlightClassByType[\"closure\"] : \"bg-white\"\n          }`}\n        >\n          임차 상담\n          <div className=\"mt-0.5 text-[10px] text-neutral-500\">\n            권리금·임대 조건 협의\n          </div>\n        </button>\n      </div>\n\n      {/* 선택된 타입에 대한 간단 폼 */}\n      {activeType && (\n        <form\n          onSubmit={handleSubmit}\n          className=\"rounded-xl border bg-neutral-50 px-3 py-3 space-y-2\"\n        >\n          <div className=\"flex items-center justify-between gap-2\">\n            <div className=\"text-xs font-medium\">\n              {labelByType[activeType]} 빠른 상담 요청\n            </div>\n            <button\n              type=\"button\"\n              onClick={closeForm}\n              className=\"text-[11px] text-neutral-500 hover:text-neutral-700\"\n            >\n              닫기\n            </button>\n          </div>\n\n          <div className=\"grid grid-cols-2 gap-2\">\n            <div>\n              <input\n                className=\"w-full rounded-lg border px-2.5 py-1.5 text-xs\"\n                placeholder=\"이름\"\n                value={name}\n                onChange={(e) => setName(e.target.value)}\n              />\n            </div>\n            <div>\n              <input\n                className=\"w-full rounded-lg border px-2.5 py-1.5 text-xs\"\n                placeholder=\"연락처 (010-...)\"\n                value={phone}\n                onChange={(e) => setPhone(e.target.value)}\n              />\n            </div>\n          </div>\n\n          <textarea\n            className=\"w-full rounded-lg border px-2.5 py-1.5 text-xs min-h-[48px]\"\n            placeholder=\"간단한 상황을 적어주시면 더 정확한 상담이 가능합니다. (선택)\"\n            value={message}\n            onChange={(e) => setMessage(e.target.value)}\n          />\n\n          <button\n            type=\"submit\"\n            disabled={loading}\n            className=\"w-full rounded-lg bg-sky-500 px-3 py-1.5 text-xs font-medium text-white hover:bg-sky-600 disabled:opacity-60\"\n          >\n            {loading ? \"전송 중...\" : `${labelByType[activeType]} 요청하기`}\n          </button>\n\n          {error && (\n            <p className=\"text-[11px] text-red-600 mt-1\">\n              {error}\n            </p>\n          )}\n          {result && (\n            <p className=\"text-[11px] text-emerald-600 mt-1\">\n              {result}\n            </p>\n          )}\n        </form>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 510, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/sanghojeong/Desktop/Projects/%EA%B6%8C%EB%A6%AC%EA%B8%88%EC%A4%91%EA%B0%9C%EC%95%B1/my-shop-transfer-app-1.3/components/ProofUpload.tsx"],"sourcesContent":["\"use client\";\n\nimport { useRouter } from \"next/navigation\";\nimport { ChangeEvent, useRef, useState } from \"react\";\n\ntype ProofUploadProps = {\n  listingId: number;\n  defaultStatus: \"verified\" | \"unverified\";\n};\n\ntype UploadResponse = {\n  ok: boolean;\n  error?: string;\n  url?: string;\n  proof_status?: \"verified\" | \"unverified\";\n};\n\nexport default function ProofUpload({\n  listingId,\n  defaultStatus,\n}: ProofUploadProps) {\n  const [status, setStatus] = useState<\"verified\" | \"unverified\">(defaultStatus);\n  const [uploading, setUploading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  const fileInputRef = useRef<HTMLInputElement | null>(null);\n  const router = useRouter();\n\n  const handleClick = () => {\n    if (uploading) return;\n    fileInputRef.current?.click();\n  };\n\n  const handleChange = async (e: ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    setUploading(true);\n    setError(null);\n\n    try {\n      const formData = new FormData();\n      formData.append(\"file\", file);\n      formData.append(\"listingId\", String(listingId));\n\n      const res = await fetch(\"/api/uploads\", {\n        method: \"POST\",\n        body: formData,\n      });\n\n      const data: UploadResponse = await res.json();\n      if (!res.ok || !data.ok) {\n        throw new Error(data.error || \"업로드 실패\");\n      }\n\n      const nextStatus = data.proof_status ?? \"verified\";\n      setStatus(nextStatus);\n\n      // 서버에서 getProofStatus를 쓰고 있으니\n      // 새 상태 반영하려면 새로고침 한 번 해주는 게 깔끔함.\n      router.refresh();\n    } catch (err: any) {\n      setError(err?.message || \"업로드 중 오류가 발생했습니다.\");\n    } finally {\n      setUploading(false);\n      // 같은 파일 다시 올릴 때도 change 이벤트가 다시 나도록 초기화\n      e.target.value = \"\";\n    }\n  };\n\n  return (\n    <div className=\"flex flex-col items-end gap-1\">\n      <input\n        ref={fileInputRef}\n        type=\"file\"\n        accept=\"image/*,application/pdf\"\n        className=\"hidden\"\n        onChange={handleChange}\n      />\n\n      <button\n        type=\"button\"\n        onClick={handleClick}\n        disabled={uploading}\n        className=\"rounded-lg border px-3 py-1.5 text-xs hover:bg-neutral-50 disabled:opacity-60\"\n      >\n        {uploading\n          ? \"업로드 중...\"\n          : status === \"verified\"\n          ? \"증빙 다시 업로드\"\n          : \"증빙 업로드\"}\n      </button>\n\n      {error && <p className=\"text-[10px] text-red-600\">{error}</p>}\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;;;AAHA;;;AAiBe,SAAS,YAAY,EAClC,SAAS,EACT,aAAa,EACI;;IACjB,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,yKAAQ,EAA4B;IAChE,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAC;IAC3C,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,yKAAQ,EAAgB;IAElD,MAAM,eAAe,IAAA,uKAAM,EAA0B;IACrD,MAAM,SAAS,IAAA,kJAAS;IAExB,MAAM,cAAc;QAClB,IAAI,WAAW;QACf,aAAa,OAAO,EAAE;IACxB;IAEA,MAAM,eAAe,OAAO;QAC1B,MAAM,OAAO,EAAE,MAAM,CAAC,KAAK,EAAE,CAAC,EAAE;QAChC,IAAI,CAAC,MAAM;QAEX,aAAa;QACb,SAAS;QAET,IAAI;YACF,MAAM,WAAW,IAAI;YACrB,SAAS,MAAM,CAAC,QAAQ;YACxB,SAAS,MAAM,CAAC,aAAa,OAAO;YAEpC,MAAM,MAAM,MAAM,MAAM,gBAAgB;gBACtC,QAAQ;gBACR,MAAM;YACR;YAEA,MAAM,OAAuB,MAAM,IAAI,IAAI;YAC3C,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,KAAK,EAAE,EAAE;gBACvB,MAAM,IAAI,MAAM,KAAK,KAAK,IAAI;YAChC;YAEA,MAAM,aAAa,KAAK,YAAY,IAAI;YACxC,UAAU;YAEV,8BAA8B;YAC9B,iCAAiC;YACjC,OAAO,OAAO;QAChB,EAAE,OAAO,KAAU;YACjB,SAAS,KAAK,WAAW;QAC3B,SAAU;YACR,aAAa;YACb,wCAAwC;YACxC,EAAE,MAAM,CAAC,KAAK,GAAG;QACnB;IACF;IAEA,qBACE,6LAAC;QAAI,WAAU;;0BACb,6LAAC;gBACC,KAAK;gBACL,MAAK;gBACL,QAAO;gBACP,WAAU;gBACV,UAAU;;;;;;0BAGZ,6LAAC;gBACC,MAAK;gBACL,SAAS;gBACT,UAAU;gBACV,WAAU;0BAET,YACG,aACA,WAAW,aACX,cACA;;;;;;YAGL,uBAAS,6LAAC;gBAAE,WAAU;0BAA4B;;;;;;;;;;;;AAGzD;GA/EwB;;QASP,kJAAS;;;KATF","debugId":null}}]
}