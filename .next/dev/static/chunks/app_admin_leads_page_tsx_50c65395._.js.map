{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/sanghojeong/Desktop/Projects/%EA%B6%8C%EB%A6%AC%EA%B8%88%EC%A4%91%EA%B0%9C%EC%95%B1/my-shop-transfer-app-1.3/app/admin/leads/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useRef, useState } from \"react\";\n\ntype LeadType = \"listing\" | \"loan\" | \"fitout\" | \"closure\";\n\ntype Lead = {\n  id: string;\n  type: LeadType;\n  listingId?: number;\n  name: string;\n  phone: string;\n  message?: string;\n  payload?: any;\n  partnerId?: string | null;\n  createdAt: number;\n};\n\nconst typeLabel: Record<LeadType, string> = {\n  listing: \"일반\",\n  loan: \"대출\",\n  fitout: \"인테리어\",\n  closure: \"임차/권리금\",\n};\n\nconst typeBadgeClass: Record<LeadType, string> = {\n  listing:\n    \"inline-flex items-center rounded-full border border-neutral-200 bg-neutral-50 px-2 py-0.5 text-[11px] text-neutral-700\",\n  loan:\n    \"inline-flex items-center rounded-full border border-sky-200 bg-sky-50 px-2 py-0.5 text-[11px] text-sky-700\",\n  fitout:\n    \"inline-flex items-center rounded-full border border-indigo-200 bg-indigo-50 px-2 py-0.5 text-[11px] text-indigo-700\",\n  closure:\n    \"inline-flex items-center rounded-full border border-emerald-200 bg-emerald-50 px-2 py-0.5 text-[11px] text-emerald-700\",\n};\n\nexport default function AdminLeadsPage() {\n  const [items, setItems] = useState<Lead[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [activeFilter, setActiveFilter] = useState<LeadType | \"all\">(\"all\");\n  const [selected, setSelected] = useState<Lead | null>(null);\n  const timerRef = useRef<number | null>(null);\n\n  const load = async (signal?: AbortSignal) => {\n    try {\n      setError(null);\n      const res = await fetch(\"/api/leads\", { cache: \"no-store\", signal });\n      const data = await res.json();\n      if (!res.ok) throw new Error(data?.error || \"불러오기 실패\");\n      const list = Array.isArray(data.items) ? (data.items as Lead[]) : [];\n      setItems(list);\n      // 선택된 리드가 있으면 최신 데이터와 동기화\n      if (selected) {\n        const updated = list.find((x) => x.id === selected.id) || null;\n        setSelected(updated);\n      }\n    } catch (e: any) {\n      if (e?.name !== \"AbortError\") setError(e?.message || \"불러오기 실패\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    const ctrl = new AbortController();\n    load(ctrl.signal); // 최초 로드\n    // 4초마다 자동 새로고침\n    timerRef.current = window.setInterval(() => load(), 4000);\n    return () => {\n      ctrl.abort();\n      if (timerRef.current) window.clearInterval(timerRef.current);\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  const filtered =\n    activeFilter === \"all\"\n      ? items\n      : items.filter((x) => x.type === activeFilter);\n\n  const handleRowClick = (item: Lead) => {\n    setSelected((prev) => (prev?.id === item.id ? null : item));\n  };\n\n  return (\n    <main className=\"max-w-4xl mx-auto p-6 space-y-4\">\n      <header className=\"flex items-center justify-between gap-3\">\n        <div>\n          <h1 className=\"text-xl font-semibold\">리드 목록</h1>\n          <p className=\"mt-1 text-xs text-neutral-500\">\n            CTA·문의로 들어온 리드를 실시간으로 확인하는 페이지입니다.\n          </p>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <button\n            onClick={() => load()}\n            className=\"rounded-lg border px-3 py-1.5 text-xs\"\n          >\n            새로고침\n          </button>\n          <span className=\"text-[11px] text-neutral-500\">\n            4초마다 자동 갱신\n          </span>\n        </div>\n      </header>\n\n      {/* 타입 필터 바 */}\n      <section className=\"flex flex-wrap items-center gap-2\">\n        {[\n          { key: \"all\" as const, label: \"전체\" },\n          { key: \"loan\" as const, label: \"대출\" },\n          { key: \"fitout\" as const, label: \"인테리어\" },\n          { key: \"closure\" as const, label: \"임차/권리금\" },\n          { key: \"listing\" as const, label: \"기타/일반\" },\n        ].map((tab) => {\n          const active = activeFilter === tab.key;\n          return (\n            <button\n              key={tab.key}\n              type=\"button\"\n              onClick={() => setActiveFilter(tab.key)}\n              className={`rounded-full border px-3 py-1 text-xs ${\n                active\n                  ? \"border-sky-500 bg-sky-50 text-sky-700\"\n                  : \"border-neutral-200 bg-white text-neutral-700 hover:bg-neutral-50\"\n              }`}\n            >\n              {tab.label}\n            </button>\n          );\n        })}\n        <span className=\"ml-auto text-[11px] text-neutral-500\">\n          총 {items.length}건 / 표시 {filtered.length}건\n        </span>\n      </section>\n\n      {/* 리스트 영역 */}\n      {loading ? (\n        <div className=\"text-sm text-neutral-600\">불러오는 중…</div>\n      ) : error ? (\n        <div className=\"text-sm text-red-600\">{error}</div>\n      ) : filtered.length === 0 ? (\n        <div className=\"text-sm text-neutral-600\">\n          조건에 맞는 리드가 없습니다.\n        </div>\n      ) : (\n        <div className=\"border rounded-lg overflow-hidden bg-white\">\n          <table className=\"w-full text-sm\">\n            <thead className=\"bg-neutral-50\">\n              <tr>\n                <th className=\"px-3 py-2 text-left w-[150px]\">시간</th>\n                <th className=\"px-3 py-2 text-left w-[90px]\">타입</th>\n                <th className=\"px-3 py-2 text-left w-[90px]\">이름</th>\n                <th className=\"px-3 py-2 text-left w-[140px]\">연락처</th>\n                <th className=\"px-3 py-2 text-left w-[80px]\">매물ID</th>\n                <th className=\"px-3 py-2 text-left w-[110px]\">파트너</th>\n                <th className=\"px-3 py-2 text-left\">메모</th>\n              </tr>\n            </thead>\n            <tbody>\n              {filtered.map((x) => {\n                const isSelected = selected?.id === x.id;\n                return (\n                  <tr\n                    key={x.id}\n                    className={`border-t cursor-pointer ${\n                      isSelected ? \"bg-sky-50/50\" : \"hover:bg-neutral-50\"\n                    }`}\n                    onClick={() => handleRowClick(x)}\n                  >\n                    <td className=\"px-3 py-2 align-top text-xs text-neutral-700\">\n                      {new Date(x.createdAt).toLocaleString()}\n                    </td>\n                    <td className=\"px-3 py-2 align-top\">\n                      <span className={typeBadgeClass[x.type]}>\n                        {typeLabel[x.type]}\n                      </span>\n                    </td>\n                    <td className=\"px-3 py-2 align-top text-xs\">{x.name}</td>\n                    <td className=\"px-3 py-2 align-top text-xs\">{x.phone}</td>\n                    <td className=\"px-3 py-2 align-top text-xs\">\n                      {x.listingId ?? \"-\"}\n                    </td>\n                    <td className=\"px-3 py-2 align-top text-xs\">\n                      {x.partnerId ?? \"-\"}\n                    </td>\n                    <td className=\"px-3 py-2 align-top text-xs text-neutral-700\">\n                      {x.message\n                        ? x.message.length > 40\n                          ? x.message.slice(0, 40) + \"…\"\n                          : x.message\n                        : x.payload?.quickMessage\n                        ? String(x.payload.quickMessage).slice(0, 40) + \"…\"\n                        : \"-\"}\n                    </td>\n                  </tr>\n                );\n              })}\n            </tbody>\n          </table>\n        </div>\n      )}\n\n      {/* 선택 리드 상세 영역 */}\n      {selected && (\n        <section className=\"rounded-lg border bg-white px-4 py-3 space-y-2 text-xs\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-2\">\n              <span className=\"font-medium\">\n                선택된 리드 상세 정보 (ID: {selected.id})\n              </span>\n              <span className={typeBadgeClass[selected.type]}>\n                {typeLabel[selected.type]}\n              </span>\n            </div>\n            <button\n              type=\"button\"\n              onClick={() => setSelected(null)}\n              className=\"text-[11px] text-neutral-500 hover:text-neutral-700\"\n            >\n              닫기\n            </button>\n          </div>\n\n          <div className=\"grid grid-cols-2 gap-x-6 gap-y-1\">\n            <div>\n              <span className=\"text-neutral-500\">이름: </span>\n              {selected.name}\n            </div>\n            <div>\n              <span className=\"text-neutral-500\">연락처: </span>\n              {selected.phone}\n            </div>\n            <div>\n              <span className=\"text-neutral-500\">매물 ID: </span>\n              {selected.listingId ?? \"-\"}\n            </div>\n            <div>\n              <span className=\"text-neutral-500\">파트너 ID: </span>\n              {selected.partnerId ?? \"-\"}\n            </div>\n            <div>\n              <span className=\"text-neutral-500\">생성 시각: </span>\n              {new Date(selected.createdAt).toLocaleString()}\n            </div>\n          </div>\n\n          <div className=\"mt-2 space-y-1\">\n            <div className=\"text-neutral-500\">메시지</div>\n            <div className=\"rounded-md border bg-neutral-50 px-2 py-2 min-h-[40px] whitespace-pre-wrap\">\n              {selected.message || selected.payload?.quickMessage || \"—\"}\n            </div>\n          </div>\n\n          {selected.payload && (\n            <div className=\"mt-2 space-y-1\">\n              <div className=\"text-neutral-500\">payload (요약)</div>\n              <pre className=\"rounded-md border bg-neutral-50 px-2 py-2 max-h-40 overflow-auto text-[11px]\">\n                {JSON.stringify(selected.payload, null, 2)}\n              </pre>\n            </div>\n          )}\n        </section>\n      )}\n    </main>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}