{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/middleware.ts"],"sourcesContent":["import { getToken } from \"next-auth/jwt\";\nimport type { NextRequest } from \"next/server\";\nimport { NextResponse } from \"next/server\";\n\n// 1. 로그인 없이도 접근 가능한 경로 (정적 파일 제외)\nconst publicPaths = [\n  \"/\", \n  \"/login\", \n  \"/register\", \n  \"/listing\", \n  \"/listing/*\", \n  \"/calculator\", \n  \"/analysis\",\n  \"/compare\",\n  \"/api/listings/*\", // 매물 정보 API는 누구나 접근 가능\n];\n\nexport async function middleware(req: NextRequest) {\n  const token = await getToken({ req, secret: process.env.NEXTAUTH_SECRET });\n  const { pathname } = req.nextUrl;\n\n  // 2. 정적 파일 및 넥스트 내부 자원은 무조건 통과 (디자인 깨짐 방지)\n  if (\n    pathname.startsWith(\"/_next\") || \n    pathname.startsWith(\"/api/auth\") ||\n    pathname.includes(\".\") // .css, .js, .png 등 확장자 포함 파일\n  ) {\n    return NextResponse.next();\n  }\n\n  // 3. 공공 경로 확인\n  const isPublic = publicPaths.some((path) => {\n    if (path.endsWith(\"/*\")) {\n      return pathname.startsWith(path.replace(\"/*\", \"\"));\n    }\n    return pathname === path;\n  });\n\n  // 4. 채팅 API 인증 체크 (리다이렉트가 아닌 401 응답)\n  if (pathname.startsWith(\"/api/chat\") && !token) {\n    return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n  }\n\n  // 5. 비공개 페이지인데 토큰이 없으면 로그인으로 리다이렉트\n  if (!isPublic && !token) {\n    const url = req.nextUrl.clone();\n    url.pathname = \"/login\";\n    url.searchParams.set(\"callbackUrl\", pathname);\n    return NextResponse.redirect(url);\n  }\n\n  return NextResponse.next();\n}\n\n// 6. 매처 설정 (매우 중요: 아래 경로들은 미들웨어를 타지 않음)\nexport const config = {\n  matcher: [\n    /*\n     * 아래로 시작하는 경로를 제외한 모든 경로에 미들웨어 적용:\n     * - _next/static (정적 파일)\n     * - _next/image (이미지 최적화 파일)\n     * - favicon.ico (파비콘)\n     * - public 폴더 내부 파일들\n     */\n    \"/((?!_next/static|_next/image|favicon.ico|.*\\\\..*).*)\",\n  ],\n};"],"names":[],"mappings":";;;;;;AAAA;AAAA;AAEA;AAAA;;;AAEA,kCAAkC;AAClC,MAAM,cAAc;IAClB;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;CACD;AAEM,eAAe,WAAW,GAAgB;IAC/C,MAAM,QAAQ,MAAM,IAAA,yJAAQ,EAAC;QAAE;QAAK,QAAQ,QAAQ,GAAG,CAAC,eAAe;IAAC;IACxE,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAI,OAAO;IAEhC,2CAA2C;IAC3C,IACE,SAAS,UAAU,CAAC,aACpB,SAAS,UAAU,CAAC,gBACpB,SAAS,QAAQ,CAAC,KAAK,8BAA8B;MACrD;QACA,OAAO,gMAAY,CAAC,IAAI;IAC1B;IAEA,cAAc;IACd,MAAM,WAAW,YAAY,IAAI,CAAC,CAAC;QACjC,IAAI,KAAK,QAAQ,CAAC,OAAO;YACvB,OAAO,SAAS,UAAU,CAAC,KAAK,OAAO,CAAC,MAAM;QAChD;QACA,OAAO,aAAa;IACtB;IAEA,qCAAqC;IACrC,IAAI,SAAS,UAAU,CAAC,gBAAgB,CAAC,OAAO;QAC9C,OAAO,gMAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAe,GAAG;YAAE,QAAQ;QAAI;IACpE;IAEA,mCAAmC;IACnC,IAAI,CAAC,YAAY,CAAC,OAAO;QACvB,MAAM,MAAM,IAAI,OAAO,CAAC,KAAK;QAC7B,IAAI,QAAQ,GAAG;QACf,IAAI,YAAY,CAAC,GAAG,CAAC,eAAe;QACpC,OAAO,gMAAY,CAAC,QAAQ,CAAC;IAC/B;IAEA,OAAO,gMAAY,CAAC,IAAI;AAC1B;AAGO,MAAM,SAAS;IACpB,SAAS;QACP;;;;;;KAMC,GACD;KACD;AACH"}}]
}