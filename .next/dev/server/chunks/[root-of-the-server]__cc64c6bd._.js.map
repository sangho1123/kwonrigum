{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/sanghojeong/Desktop/Projects/%EA%B6%8C%EB%A6%AC%EA%B8%88%EC%A4%91%EA%B0%9C%EC%95%B1/my-shop-transfer-app-1.3/lib/partners.ts"],"sourcesContent":["// lib/partners.ts\n\nexport type PartnerType = \"broker\" | \"lender\" | \"fitout\" | \"closure\";\n\nexport type Partner = {\n  id: string;\n  name: string;\n  type: PartnerType;\n  areas?: string[];       // [\"강남구\", \"관악구\"] 등\n  categories?: string[];  // [\"카페/디저트\", \"치킨\"] 등\n  webhookUrl: string;     // 우리 서버의 수신 데모 엔드포인트로 연결\n};\n\n// 데모 파트너 레지스트리\nexport const partners: Partner[] = [\n  {\n    id: \"lend-001\",\n    name: \"샘플 대출 제휴사\",\n    type: \"lender\",\n    areas: [\"강남구\", \"관악구\"],\n    webhookUrl: \"/api/partners/webhook\",\n  },\n  {\n    id: \"fit-001\",\n    name: \"샘플 인테리어 제휴사\",\n    type: \"fitout\",\n    areas: [\"강남구\", \"관악구\"],\n    webhookUrl: \"/api/partners/webhook\",\n  },\n  {\n    id: \"close-001\",\n    name: \"샘플 폐업정리 제휴사\",\n    type: \"closure\",\n    webhookUrl: \"/api/partners/webhook\",\n  },\n];\n"],"names":[],"mappings":"AAAA,kBAAkB;;;;;AAcX,MAAM,WAAsB;IACjC;QACE,IAAI;QACJ,MAAM;QACN,MAAM;QACN,OAAO;YAAC;YAAO;SAAM;QACrB,YAAY;IACd;IACA;QACE,IAAI;QACJ,MAAM;QACN,MAAM;QACN,OAAO;YAAC;YAAO;SAAM;QACrB,YAAY;IACd;IACA;QACE,IAAI;QACJ,MAAM;QACN,MAAM;QACN,YAAY;IACd;CACD","debugId":null}},
    {"offset": {"line": 83, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/sanghojeong/Desktop/Projects/%EA%B6%8C%EB%A6%AC%EA%B8%88%EC%A4%91%EA%B0%9C%EC%95%B1/my-shop-transfer-app-1.3/lib/store.ts"],"sourcesContent":["// lib/store.ts\n\n// ---- Lead demo store ----\n\nexport type Lead = {\n  id: string;\n  type: \"listing\" | \"loan\" | \"fitout\" | \"closure\";\n  listingId?: number;\n  name: string;\n  phone: string;\n  message?: string;\n  payload?: any;\n  partnerId?: string | null;\n  createdAt: number;\n};\n\nexport const leads: Lead[] = [];\n\n// ---- Proof demo store ----\n\n// 검증 상태 타입을 분리해서 재사용\nexport type ProofStatus = \"verified\" | \"unverified\";\n\nexport type Proof = {\n  id: string;\n  listingId: number;\n  filename?: string;\n  uploadedAt: number;\n};\n\nexport const proofs: Proof[] = [];\n\n// 인메모리 검증 상태 맵\nconst proofStatusByListing = new Map<number, ProofStatus>();\n\nexport function setProofStatus(listingId: number, status: ProofStatus) {\n  proofStatusByListing.set(listingId, status);\n}\n\nexport function getProofStatus(\n  listingId: number\n): ProofStatus | undefined {\n  return proofStatusByListing.get(listingId);\n}\n"],"names":[],"mappings":"AAAA,eAAe;AAEf,4BAA4B;;;;;;;;;;;AAcrB,MAAM,QAAgB,EAAE;AAcxB,MAAM,SAAkB,EAAE;AAEjC,eAAe;AACf,MAAM,uBAAuB,IAAI;AAE1B,SAAS,eAAe,SAAiB,EAAE,MAAmB;IACnE,qBAAqB,GAAG,CAAC,WAAW;AACtC;AAEO,SAAS,eACd,SAAiB;IAEjB,OAAO,qBAAqB,GAAG,CAAC;AAClC","debugId":null}},
    {"offset": {"line": 109, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/sanghojeong/Desktop/Projects/%EA%B6%8C%EB%A6%AC%EA%B8%88%EC%A4%91%EA%B0%9C%EC%95%B1/my-shop-transfer-app-1.3/app/api/leads/route.ts"],"sourcesContent":["// app/api/leads/route.ts\nimport { NextRequest, NextResponse } from \"next/server\";\nimport { partners } from \"../../../lib/partners\";\nimport { Lead, leads } from \"../../../lib/store\";\n\nconst ALLOWED_TYPES = new Set([\"listing\", \"loan\", \"fitout\", \"closure\"]);\nconst DEDUP_WINDOW_MS = 2 * 60 * 1000; // 2분\nconst WEBHOOK_TIMEOUT_MS = 3000;\n\n// 간단 CORS 헬퍼 (외부 도메인 폼 직접 POST 허용용)\nfunction withCors<T extends NextResponse>(res: T) {\n  res.headers.set(\"Access-Control-Allow-Origin\", \"*\");\n  res.headers.set(\"Access-Control-Allow-Methods\", \"GET,POST,OPTIONS\");\n  res.headers.set(\"Access-Control-Allow-Headers\", \"Content-Type\");\n  return res;\n}\n\nexport async function OPTIONS() {\n  return withCors(new NextResponse(null, { status: 204 }));\n}\n\n// GET: 데모용 전체 리드 리턴 (+limit 쿼리 지원)\nexport async function GET(req: NextRequest) {\n  const limitParam = req.nextUrl.searchParams.get(\"limit\");\n  const limit = Math.max(\n    1,\n    Math.min(500, Number.isFinite(Number(limitParam)) ? Number(limitParam) : 100)\n  );\n  // 최신 먼저\n  const items = leads.slice(0, limit);\n  return withCors(NextResponse.json({ ok: true, items }));\n}\n\nexport async function POST(req: NextRequest) {\n  try {\n    let body: any;\n    try {\n      body = await req.json();\n    } catch {\n      return withCors(\n        NextResponse.json({ ok: false, error: \"잘못된 JSON 본문\" }, { status: 400 })\n      );\n    }\n\n    // 추출 + 기본값\n    let {\n      type = \"listing\",\n      listingId,\n      name,\n      phone,\n      message,\n      payload,\n    } = body ?? {};\n\n    // 기본 검증\n    if (typeof name !== \"string\" || typeof phone !== \"string\") {\n      return withCors(\n        NextResponse.json(\n          { ok: false, error: \"필수 값 누락 또는 타입 불일치(name, phone)\" },\n          { status: 400 }\n        )\n      );\n    }\n\n    // type 정규화\n    if (typeof type !== \"string\") type = \"listing\";\n    type = String(type).toLowerCase().trim();\n    if (!ALLOWED_TYPES.has(type)) type = \"listing\";\n\n    // listingId 숫자 검증 (선택값)\n    let listingIdNum: number | undefined = undefined;\n    if (listingId !== undefined && listingId !== null && listingId !== \"\") {\n      const n = Number(listingId);\n      if (!Number.isFinite(n)) {\n        return withCors(\n          NextResponse.json(\n            { ok: false, error: \"listingId는 숫자여야 합니다\" },\n            { status: 422 }\n          )\n        );\n      }\n      listingIdNum = n;\n    }\n\n    // 이름/전화 정규화\n    const nameTrim = name.trim();\n    const phoneDigits = String(phone).replace(/\\D+/g, \"\");\n    if (!nameTrim) {\n      return withCors(\n        NextResponse.json({ ok: false, error: \"이름이 비어있습니다\" }, { status: 422 })\n      );\n    }\n    if (phoneDigits.length < 8) {\n      return withCors(\n        NextResponse.json(\n          { ok: false, error: \"전화번호 형식이 올바르지 않습니다\" },\n          { status: 422 }\n        )\n      );\n    }\n\n    // payload는 객체만 허용(선택)\n    if (\n      payload !== undefined &&\n      payload !== null &&\n      (typeof payload !== \"object\" || Array.isArray(payload))\n    ) {\n      return withCors(\n        NextResponse.json({ ok: false, error: \"payload는 객체여야 합니다\" }, { status: 422 })\n      );\n    }\n\n    // 디듀프: 동일 (name, phone, listingId, type) 2분 내 재접수 방지\n    const now = Date.now();\n    const dup = leads.find(\n      (l) =>\n        l.type === type &&\n        l.name === nameTrim &&\n        l.phone === phoneDigits &&\n        (l.listingId ?? undefined) === (listingIdNum ?? undefined) &&\n        now - l.createdAt < DEDUP_WINDOW_MS\n    );\n    if (dup) {\n      return withCors(\n        NextResponse.json({\n          ok: true,\n          id: dup.id,\n          partnerId: dup.partnerId,\n          dedup: true,\n        })\n      );\n    }\n\n    // 리드 생성\n    const id =\n      typeof crypto !== \"undefined\" && typeof crypto.randomUUID === \"function\"\n        ? crypto.randomUUID()\n        : String(now);\n\n    const lead: Lead = {\n      id,\n      type,\n      listingId: listingIdNum,\n      name: nameTrim,\n      phone: phoneDigits,\n      message,\n      payload,\n      partnerId: null,\n      createdAt: now,\n    };\n\n    // 파트너 라우팅: type별 매핑\n    // loan -> lender, fitout -> fitout, closure -> closure, listing -> 전달 안함(내부 처리)\n    const routeType =\n      type === \"loan\" ? \"lender\" : type === \"fitout\" ? \"fitout\" : type === \"closure\" ? \"closure\" : null;\n\n    const partner =\n      routeType ? partners.find((p) => p.type === routeType) : null;\n\n    if (partner) {\n      // 웹훅 호출 (타임아웃/실패 허용: 실패해도 리드는 저장)\n      const controller = new AbortController();\n      const timer = setTimeout(() => controller.abort(), WEBHOOK_TIMEOUT_MS);\n      try {\n        const resp = await fetch(partner.webhookUrl, {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({ partnerId: partner.id, lead }),\n          signal: controller.signal,\n        });\n        if (resp.ok) {\n          lead.partnerId = partner.id;\n        } else {\n          // 실패면 partnerId 유지(null)\n          // 필요시 resp.text() 로깅 가능\n        }\n      } catch {\n        // 타임아웃/네트워크 오류 → 무시하고 내부 저장 진행\n      } finally {\n        clearTimeout(timer);\n      }\n    }\n\n    // 선두에 저장(최근 순)\n    leads.unshift(lead);\n\n    // 민감정보 과다 로깅 방지: phone은 로깅하지 않음\n    console.log(\"[LEAD] created\", {\n      id: lead.id,\n      type: lead.type,\n      listingId: lead.listingId,\n      partnerId: lead.partnerId,\n    });\n\n    return withCors(\n      NextResponse.json(\n        { ok: true, id: lead.id, partnerId: lead.partnerId },\n        { status: 201 }\n      )\n    );\n  } catch (e: any) {\n    return withCors(\n      NextResponse.json(\n        { ok: false, error: e?.message || \"서버 오류\" },\n        { status: 500 }\n      )\n    );\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}