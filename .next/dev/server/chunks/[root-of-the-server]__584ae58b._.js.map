{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/sanghojeong/Desktop/Projects/%EA%B6%8C%EB%A6%AC%EA%B8%88%EC%A4%91%EA%B0%9C%EC%95%B1/shop-transfer-1.1/lib/db.ts"],"sourcesContent":["// lib/db.ts\nimport { PrismaClient } from \"@prisma/client\";\n\nconst globalForPrisma = globalThis as unknown as { prisma?: PrismaClient };\n\nexport const prisma =\n  globalForPrisma.prisma ??\n  new PrismaClient({\n    log: process.env.NODE_ENV === \"development\" ? [\"query\", \"error\", \"warn\"] : [\"error\"],\n  });\n\nif (process.env.NODE_ENV !== \"production\") globalForPrisma.prisma = prisma;\n"],"names":[],"mappings":"AAAA,YAAY;;;;;AACZ;;AAEA,MAAM,kBAAkB;AAEjB,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KAAK,uCAAyC;QAAC;QAAS;QAAS;KAAO,GAAG;AAC7E;AAEF,wCAA2C,gBAAgB,MAAM,GAAG","debugId":null}},
    {"offset": {"line": 84, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/sanghojeong/Desktop/Projects/%EA%B6%8C%EB%A6%AC%EA%B8%88%EC%A4%91%EA%B0%9C%EC%95%B1/shop-transfer-1.1/lib/auth.ts"],"sourcesContent":["// lib/auth.ts\nimport { prisma } from \"@/lib/db\";\nimport { compare } from \"bcryptjs\";\nimport NextAuth, { type NextAuthConfig } from \"next-auth\";\nimport Credentials from \"next-auth/providers/credentials\";\n\nexport const authOptions: NextAuthConfig = {\n  trustHost: true,\n  session: { strategy: \"jwt\" },\n  pages: { signIn: \"/login\" },\n  providers: [\n    Credentials({\n      name: \"Credentials\",\n      credentials: {\n        email: { label: \"이메일\", type: \"email\" },\n        password: { label: \"비밀번호\", type: \"password\" },\n      },\n      authorize: async (creds) => {\n        const email =\n          typeof creds?.email === \"string\" ? creds.email.trim().toLowerCase() : \"\";\n        const password =\n          typeof creds?.password === \"string\" ? creds.password.trim() : \"\";\n      \n        if (!email || !password) return null;\n      \n        const user = await prisma.user.findUnique({\n          where: { email },\n          select: { id: true, email: true, name: true, role: true, password: true },\n        });\n        if (!user || !user.password) return null;\n      \n        const ok = await compare(password, user.password);\n        if (!ok) return null;\n      \n        return {\n          id: user.id,\n          name: user.name ?? user.email,\n          email: user.email,\n          role: user.role,\n        } as any;\n      }\n    }),\n  ],\n  callbacks: {\n    async jwt({ token, user }: { token: import(\"next-auth/jwt\").JWT; user?: any }) {\n      if (user) {\n        token.id = user.id;\n        token.role = user.role;\n      }\n      return token;\n    },\n    async session({\n      session,\n      token,\n    }: {\n      session: import(\"next-auth\").Session;\n      token: import(\"next-auth/jwt\").JWT;\n    }) {\n      if (session.user) {\n        (session.user as any).id = token.id as string;\n        (session.user as any).role = token.role as string;\n      }\n      return session;\n    },\n  },\n};\n\nexport const { handlers, auth, signIn, signOut } = NextAuth(authOptions);\n"],"names":[],"mappings":"AAAA,cAAc;;;;;;;;;;;;;AACd;AACA;AACA;AACA;AAAA;;;;;AAEO,MAAM,cAA8B;IACzC,WAAW;IACX,SAAS;QAAE,UAAU;IAAM;IAC3B,OAAO;QAAE,QAAQ;IAAS;IAC1B,WAAW;QACT,IAAA,uKAAW,EAAC;YACV,MAAM;YACN,aAAa;gBACX,OAAO;oBAAE,OAAO;oBAAO,MAAM;gBAAQ;gBACrC,UAAU;oBAAE,OAAO;oBAAQ,MAAM;gBAAW;YAC9C;YACA,WAAW,OAAO;gBAChB,MAAM,QACJ,OAAO,OAAO,UAAU,WAAW,MAAM,KAAK,CAAC,IAAI,GAAG,WAAW,KAAK;gBACxE,MAAM,WACJ,OAAO,OAAO,aAAa,WAAW,MAAM,QAAQ,CAAC,IAAI,KAAK;gBAEhE,IAAI,CAAC,SAAS,CAAC,UAAU,OAAO;gBAEhC,MAAM,OAAO,MAAM,qHAAM,CAAC,IAAI,CAAC,UAAU,CAAC;oBACxC,OAAO;wBAAE;oBAAM;oBACf,QAAQ;wBAAE,IAAI;wBAAM,OAAO;wBAAM,MAAM;wBAAM,MAAM;wBAAM,UAAU;oBAAK;gBAC1E;gBACA,IAAI,CAAC,QAAQ,CAAC,KAAK,QAAQ,EAAE,OAAO;gBAEpC,MAAM,KAAK,MAAM,IAAA,8IAAO,EAAC,UAAU,KAAK,QAAQ;gBAChD,IAAI,CAAC,IAAI,OAAO;gBAEhB,OAAO;oBACL,IAAI,KAAK,EAAE;oBACX,MAAM,KAAK,IAAI,IAAI,KAAK,KAAK;oBAC7B,OAAO,KAAK,KAAK;oBACjB,MAAM,KAAK,IAAI;gBACjB;YACF;QACF;KACD;IACD,WAAW;QACT,MAAM,KAAI,EAAE,KAAK,EAAE,IAAI,EAAsD;YAC3E,IAAI,MAAM;gBACR,MAAM,EAAE,GAAG,KAAK,EAAE;gBAClB,MAAM,IAAI,GAAG,KAAK,IAAI;YACxB;YACA,OAAO;QACT;QACA,MAAM,SAAQ,EACZ,OAAO,EACP,KAAK,EAIN;YACC,IAAI,QAAQ,IAAI,EAAE;gBACf,QAAQ,IAAI,CAAS,EAAE,GAAG,MAAM,EAAE;gBAClC,QAAQ,IAAI,CAAS,IAAI,GAAG,MAAM,IAAI;YACzC;YACA,OAAO;QACT;IACF;AACF;AAEO,MAAM,EAAE,QAAQ,EAAE,IAAI,EAAE,MAAM,EAAE,OAAO,EAAE,GAAG,IAAA,kKAAQ,EAAC","debugId":null}},
    {"offset": {"line": 177, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/sanghojeong/Desktop/Projects/%EA%B6%8C%EB%A6%AC%EA%B8%88%EC%A4%91%EA%B0%9C%EC%95%B1/shop-transfer-1.1/app/api/listing-intake/route.ts"],"sourcesContent":["// app/api/listing-intake/route.ts\nimport { auth } from \"@/lib/auth\";\nimport { PrismaClient } from \"@prisma/client\";\nimport { NextResponse } from \"next/server\";\n\nconst prisma = new PrismaClient();\n\nexport async function POST(req: Request) {\n  try {\n    const session = await auth();\n    if (!session || !session.user?.email) {\n      return NextResponse.json({ ok: false, error: \"Unauthorized\" }, { status: 401 });\n    }\n\n    const body = await req.json();\n    const {\n      title,\n      category,\n      address_area,\n      deposit,\n      rent_monthly,\n      goodwill_price,\n      monthly_sales,\n      parking_spaces,\n      description,\n      // 추가된 필드들\n      lat,\n      lng,\n      buildingLedgerUrl,\n      registryUrl,\n      revenueProofUrl,\n    } = body;\n\n    // 간단한 서버 측 유효성 검사 (여기서는 파일이 업로드 되었다면 인증된 것으로 간주하는 로직 예시)\n    // 실제로는 관리자가 확인 후 true로 변경하는 것이 일반적입니다.\n    const isBuildingLedgerVerified = !!buildingLedgerUrl; \n    const isRegistryVerified = !!registryUrl;\n    const isRevenueVerified = !!revenueProofUrl;\n\n    const user = await prisma.user.findUnique({\n      where: { email: session.user.email },\n    });\n\n    if (!user) {\n      return NextResponse.json({ ok: false, error: \"User not found\" }, { status: 404 });\n    }\n\n    const newListing = await prisma.listing.create({\n      data: {\n        ownerId: user.id,\n        title,\n        category,\n        address_area,\n        deposit,\n        rent_monthly,\n        goodwill_price,\n        monthly_sales,\n        parking_spaces,\n        description,\n        lat: lat || 37.5665, // 기본값 (서울 시청)\n        lng: lng || 126.9780,\n        buildingLedgerUrl,\n        registryUrl,\n        revenueProofUrl,\n        isBuildingLedgerVerified,\n        isRegistryVerified,\n        isRevenueVerified,\n        photos: JSON.stringify([]), // 사진은 별도 업로드가 필요하므로 빈 배열\n      },\n    });\n\n    return NextResponse.json({ ok: true, id: newListing.id });\n  } catch (error: any) {\n    console.error(\"Listing Create Error:\", error);\n    return NextResponse.json({ ok: false, error: error.message }, { status: 500 });\n  }\n}"],"names":[],"mappings":"AAAA,kCAAkC;;;;;AAClC;AACA;AACA;;;;AAEA,MAAM,SAAS,IAAI,6IAAY;AAExB,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,UAAU,MAAM,IAAA,qHAAI;QAC1B,IAAI,CAAC,WAAW,CAAC,QAAQ,IAAI,EAAE,OAAO;YACpC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,IAAI;gBAAO,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QAC/E;QAEA,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,EACJ,KAAK,EACL,QAAQ,EACR,YAAY,EACZ,OAAO,EACP,YAAY,EACZ,cAAc,EACd,aAAa,EACb,cAAc,EACd,WAAW,EACX,UAAU;QACV,GAAG,EACH,GAAG,EACH,iBAAiB,EACjB,WAAW,EACX,eAAe,EAChB,GAAG;QAEJ,yDAAyD;QACzD,uCAAuC;QACvC,MAAM,2BAA2B,CAAC,CAAC;QACnC,MAAM,qBAAqB,CAAC,CAAC;QAC7B,MAAM,oBAAoB,CAAC,CAAC;QAE5B,MAAM,OAAO,MAAM,OAAO,IAAI,CAAC,UAAU,CAAC;YACxC,OAAO;gBAAE,OAAO,QAAQ,IAAI,CAAC,KAAK;YAAC;QACrC;QAEA,IAAI,CAAC,MAAM;YACT,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,IAAI;gBAAO,OAAO;YAAiB,GAAG;gBAAE,QAAQ;YAAI;QACjF;QAEA,MAAM,aAAa,MAAM,OAAO,OAAO,CAAC,MAAM,CAAC;YAC7C,MAAM;gBACJ,SAAS,KAAK,EAAE;gBAChB;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA,KAAK,OAAO;gBACZ,KAAK,OAAO;gBACZ;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA,QAAQ,KAAK,SAAS,CAAC,EAAE;YAC3B;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAM,IAAI,WAAW,EAAE;QAAC;IACzD,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAO,OAAO,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IAC9E;AACF","debugId":null}}]
}