{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/sanghojeong/Desktop/Projects/%EA%B6%8C%EB%A6%AC%EA%B8%88%EC%A4%91%EA%B0%9C%EC%95%B1/shop-transfer-1.2/proxy.ts"],"sourcesContent":["import { getToken } from \"next-auth/jwt\";\nimport type { NextRequest } from \"next/server\";\nimport { NextResponse } from \"next/server\";\n\nexport async function proxy(req: NextRequest) {\n  const { pathname } = req.nextUrl;\n\n  // 1. API 및 자원 무조건 통과\n  if (\n    pathname.startsWith(\"/api\") || \n    pathname.startsWith(\"/_next\") || \n    pathname.includes(\".\") ||\n    pathname === \"/favicon.ico\"\n  ) {\n    return NextResponse.next();\n  }\n\n  // 2. 토큰 확인\n  const token = await getToken({ \n    req, \n    // .env의 NEXTAUTH_SECRET을 정확히 참조\n    secret: process.env.NEXTAUTH_SECRET \n  });\n\n  // 3. 공개 페이지 (나머지는 모두 보호)\n  const publicPaths = [\"/\", \"/login\", \"/register\", \"/listing\", \"/compare\", \"/calculator\"];\n  const isPublic = publicPaths.some(path => \n    pathname === path || pathname.startsWith(\"/listing/\")\n  );\n\n  // 4. ✅ 핵심: 채팅방(/chat) 등 보호된 페이지 접근 시 토큰이 있으면 통과\n  if (token) {\n    // 이미 로그인된 사용자가 로그인창 가려 하면 메인으로\n    if (pathname === \"/login\" || pathname === \"/register\") {\n      return NextResponse.redirect(new URL(\"/\", req.url));\n    }\n    return NextResponse.next();\n  }\n\n  // 5. 토큰 없는데 비공개 페이지 가려 하면 로그인으로\n  if (!isPublic && !token) {\n    const loginUrl = new URL(\"/login\", req.url);\n    loginUrl.searchParams.set(\"callbackUrl\", pathname);\n    return NextResponse.redirect(loginUrl);\n  }\n\n  return NextResponse.next();\n}\n\nexport const config = {\n  matcher: [\"/((?!api/auth|_next/static|_next/image|favicon.ico).*)\"],\n};"],"names":[],"mappings":";;;;;;AAAA;AAAA;AAEA;;;AAEO,eAAe,MAAM,GAAgB;IAC1C,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAI,OAAO;IAEhC,qBAAqB;IACrB,IACE,SAAS,UAAU,CAAC,WACpB,SAAS,UAAU,CAAC,aACpB,SAAS,QAAQ,CAAC,QAClB,aAAa,gBACb;QACA,OAAO,8IAAY,CAAC,IAAI;IAC1B;IAEA,WAAW;IACX,MAAM,QAAQ,MAAM,IAAA,iJAAQ,EAAC;QAC3B;QACA,gCAAgC;QAChC,QAAQ,QAAQ,GAAG,CAAC,eAAe;IACrC;IAEA,yBAAyB;IACzB,MAAM,cAAc;QAAC;QAAK;QAAU;QAAa;QAAY;QAAY;KAAc;IACvF,MAAM,WAAW,YAAY,IAAI,CAAC,CAAA,OAChC,aAAa,QAAQ,SAAS,UAAU,CAAC;IAG3C,gDAAgD;IAChD,IAAI,OAAO;QACT,+BAA+B;QAC/B,IAAI,aAAa,YAAY,aAAa,aAAa;YACrD,OAAO,8IAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,KAAK,IAAI,GAAG;QACnD;QACA,OAAO,8IAAY,CAAC,IAAI;IAC1B;IAEA,gCAAgC;IAChC,IAAI,CAAC,YAAY,CAAC,OAAO;QACvB,MAAM,WAAW,IAAI,IAAI,UAAU,IAAI,GAAG;QAC1C,SAAS,YAAY,CAAC,GAAG,CAAC,eAAe;QACzC,OAAO,8IAAY,CAAC,QAAQ,CAAC;IAC/B;IAEA,OAAO,8IAAY,CAAC,IAAI;AAC1B;AAEO,MAAM,SAAS;IACpB,SAAS;QAAC;KAAyD;AACrE","debugId":null}}]
}