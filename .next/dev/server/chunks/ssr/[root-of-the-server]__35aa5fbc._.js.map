{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 24, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/sanghojeong/Desktop/Projects/%EA%B6%8C%EB%A6%AC%EA%B8%88%EC%A4%91%EA%B0%9C%EC%95%B1/my-shop-transfer-app%20v1.2/lib/db.ts"],"sourcesContent":["// lib/db.ts\nimport { PrismaClient } from \"@prisma/client\";\n\nconst globalForPrisma = globalThis as unknown as { prisma?: PrismaClient };\n\nexport const prisma =\n  globalForPrisma.prisma ??\n  new PrismaClient({\n    log: process.env.NODE_ENV === \"development\" ? [\"query\", \"error\", \"warn\"] : [\"error\"],\n  });\n\nif (process.env.NODE_ENV !== \"production\") globalForPrisma.prisma = prisma;\n"],"names":[],"mappings":"AAAA,YAAY;;;;;AACZ;;AAEA,MAAM,kBAAkB;AAEjB,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KAAK,uCAAyC;QAAC;QAAS;QAAS;KAAO,GAAG;AAC7E;AAEF,wCAA2C,gBAAgB,MAAM,GAAG","debugId":null}},
    {"offset": {"line": 44, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/sanghojeong/Desktop/Projects/%EA%B6%8C%EB%A6%AC%EA%B8%88%EC%A4%91%EA%B0%9C%EC%95%B1/my-shop-transfer-app%20v1.2/app/listing/%5Bid%5D/page.tsx"],"sourcesContent":["// app/listing/[id]/page.tsx\nimport { prisma } from \"@/lib/db\";\nimport Image from \"next/image\";\nimport Link from \"next/link\";\nimport { notFound } from \"next/navigation\";\n\nexport default async function ListingDetailPage({\n  params,\n}: {\n  params: Promise<{ id: string }>;\n}) {\n  // Next 15/16: params는 Promise\n  const { id } = await params;\n  const num = Number(id);\n  if (!Number.isFinite(num)) notFound();\n\n  // ✅ auth는 지연 import 해서 lib/auth 내부 핸들러 구성 문제로\n  //   모듈 평가 단계에서 터지는 걸 회피\n  let meId: string | undefined;\n  let myRole: \"ADMIN\" | \"CLIENT\" | undefined;\n  try {\n    const { auth } = await import(\"@/lib/auth\");\n    const session = await auth().catch(() => null);\n    meId = (session?.user as any)?.id as string | undefined;\n    myRole = (session?.user as any)?.role as \"ADMIN\" | \"CLIENT\" | undefined;\n  } catch {\n    // 로그인 세션 없이도 상세는 볼 수 있어야 하므로 무시\n  }\n\n  // DB 조회 (필요 필드만)\n  let item: any = null;\n  try {\n    item = await prisma.listing.findUnique({\n      where: { id: num },\n      select: {\n        id: true,\n        title: true,\n        category: true,\n        address_area: true,\n        address_full: true,\n        lat: true,\n        lng: true,\n        rent_monthly: true,\n        deposit: true,\n        goodwill_price: true,\n        monthly_sales: true,\n        parking_spaces: true,\n        ownerId: true,\n        // 사진이 relation인 경우\n        // (스키마에 없으면 TS 경고 피하려고 any 캐스팅)\n        media: {\n          where: { is_public: true, file_type: \"photo\" } as any,\n          select: { file_url: true } as any,\n        } as any,\n        // 사진이 배열/JSON 컬럼인 경우\n        photos: true as any,\n      },\n    });\n  } catch {\n    // prisma 미설정/스키마 미스매치 시 notFound로 정리\n  }\n  if (!item) notFound();\n\n  // 사진 수집: photos(Array/JSON) → media(relation) 순서\n  const photos: string[] = Array.isArray(item?.photos)\n    ? (item.photos as string[])\n    : Array.isArray(item?.media)\n    ? (item.media as Array<{ file_url: string }>).map((m) => m.file_url)\n    : [];\n\n  const canEdit = !!meId && (item.ownerId === meId || myRole === \"ADMIN\");\n\n  const fmt = (n?: number | null) =>\n    n == null ? \"-\" : new Intl.NumberFormat(\"ko-KR\").format(n);\n\n  return (\n    <main className=\"max-w-4xl mx-auto p-4 space-y-4\">\n      <header className=\"flex items-start justify-between gap-3\">\n        <div>\n          <h1 className=\"text-xl font-semibold\">{item.title ?? \"(제목 없음)\"}</h1>\n          {item.address_area && (\n            <div className=\"text-sm text-neutral-600\">{item.address_area}</div>\n          )}\n        </div>\n\n        {canEdit && (\n          <Link\n            href={`/listing/${item.id}/edit`}\n            className=\"rounded-lg border px-3 py-1.5 text-sm hover:bg-neutral-50\"\n          >\n            수정\n          </Link>\n        )}\n      </header>\n\n      {photos.length > 0 && (\n        <div className=\"grid grid-cols-2 gap-3\">\n          {photos.slice(0, 2).map((src, i) => (\n            <div\n              key={i}\n              className=\"relative aspect-[4/3] rounded-xl overflow-hidden border bg-neutral-100\"\n            >\n              <Image\n                src={src}\n                alt={`photo-${i}`}\n                fill\n                sizes=\"(max-width: 768px) 100vw, 50vw\"\n                style={{ objectFit: \"cover\" }}\n              />\n            </div>\n          ))}\n        </div>\n      )}\n\n      <section className=\"rounded-2xl border bg-white p-4\">\n        <div className=\"grid grid-cols-2 gap-x-8 gap-y-2 text-sm\">\n          <div>월세: {fmt(item.rent_monthly)}</div>\n          <div>임대보증금: {fmt(item.deposit)}</div>\n          <div>권리금: {fmt(item.goodwill_price)}</div>\n          <div>월매출: {fmt(item.monthly_sales)}</div>\n          <div>주차: {item.parking_spaces ?? 0}대</div>\n          <div>\n            좌표: {item.lat ?? \"-\"}, {item.lng ?? \"-\"}\n          </div>\n        </div>\n      </section>\n\n      {/* 필요 없으면 아래 섹션 제거해도 됨 */}\n      <section className=\"rounded-2xl border bg-white p-4\">\n        <div className=\"font-medium mb-2\">상담</div>\n        <div className=\"flex gap-2\">\n          <Link\n            href={`/chat?type=listing&listingId=${item.id}&title=${encodeURIComponent(\n              item.title ?? \"\"\n            )}`}\n            className=\"rounded-lg bg-sky-500 text-white px-3 py-1.5 text-sm\"\n          >\n            매물문의\n          </Link>\n          <Link\n            href={`/chat?type=loan&listingId=${item.id}&title=${encodeURIComponent(\n              item.title ?? \"\"\n            )}`}\n            className=\"rounded-lg bg-sky-400 text-white px-3 py-1.5 text-sm\"\n          >\n            대출문의\n          </Link>\n          <Link\n            href={`/chat?type=fitout&listingId=${item.id}&title=${encodeURIComponent(\n              item.title ?? \"\"\n            )}`}\n            className=\"rounded-lg bg-sky-600 text-white px-3 py-1.5 text-sm\"\n          >\n            인테리어문의\n          </Link>\n        </div>\n      </section>\n    </main>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}