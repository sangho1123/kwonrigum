{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/sanghojeong/Desktop/Projects/%EA%B6%8C%EB%A6%AC%EA%B8%88%EC%A4%91%EA%B0%9C%EC%95%B1/my-shop-transfer-app-1.2/components/ListingMap.tsx"],"sourcesContent":["// components/ListingMap.tsx\n\"use client\";\n\nimport type { Listing } from \"@/lib/mockData\";\nimport { useEffect, useRef, useState } from \"react\";\n\ndeclare global {\n  interface Window {\n    naver: any;\n    navermap_authFailure?: () => void;\n  }\n}\n\n// ✅ Web JS v3: openapi + ncpClientId (동작 확인된 방식)\nconst NAVER_CLIENT_ID =\n  process.env.NEXT_PUBLIC_NAVER_MAP_CLIENT_ID ?? \"hdlzlfn5o0\";\n\nexport default function ListingMap({\n  items,\n  selectedId,\n  onSelect,\n}: {\n  items: Listing[];\n  selectedId?: number | null;\n  onSelect?: (id: number) => void;\n}) {\n  const mapRef = useRef<HTMLDivElement | null>(null);\n  const mapObj = useRef<any>(null);\n  const markersRef = useRef<Record<number, any>>({});\n  const [loaded, setLoaded] = useState(false);\n  const [authFailed, setAuthFailed] = useState(false);\n\n  // 인증 실패 콜백\n  useEffect(() => {\n    if (typeof window === \"undefined\") return;\n    window.navermap_authFailure = function () {\n      console.error(\"[NAVER MAP] Authentication Failed\");\n      setAuthFailed(true);\n    };\n  }, []);\n\n  // SDK 로드\n  useEffect(() => {\n    if (typeof window === \"undefined\") return;\n    if (window.naver?.maps) {\n      setLoaded(true);\n      return;\n    }\n    const id = \"naver-map-sdk\";\n    let s = document.getElementById(id) as HTMLScriptElement | null;\n    const src = `https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=${NAVER_CLIENT_ID}&_=${Date.now()}`;\n    if (!s) {\n      s = document.createElement(\"script\");\n      s.id = id;\n      s.async = true;\n      s.defer = true;\n      document.head.appendChild(s);\n    }\n    s.src = src;\n    s.onload = () => {\n      console.log(\"[NAVER MAP] SDK loaded\", { ncpClientId: NAVER_CLIENT_ID });\n      setLoaded(true);\n    };\n    s.onerror = () => console.error(\"[NAVER MAP] SDK load error\");\n  }, []);\n\n  // 지도/마커\n  useEffect(() => {\n    if (!loaded || !mapRef.current || !window.naver?.maps || authFailed) return;\n    const { naver } = window;\n\n    const first = items[0];\n    const center = first\n      ? new naver.maps.LatLng(first.lat, first.lng)\n      : new naver.maps.LatLng(37.5665, 126.9780);\n    const map = new naver.maps.Map(mapRef.current, {\n      center,\n      zoom: 13,\n      zoomControl: true,\n      zoomControlOptions: { position: naver.maps.Position.TOP_RIGHT },\n    });\n    mapObj.current = map;\n\n    // 기존 마커 제거\n    Object.values(markersRef.current).forEach((m) => m.setMap(null));\n    markersRef.current = {};\n\n    // 마커 생성\n    const bounds = new naver.maps.LatLngBounds();\n    items.forEach((it) => {\n      const pos = new naver.maps.LatLng(it.lat, it.lng);\n      bounds.extend(pos);\n\n      const marker = new naver.maps.Marker({\n        map,\n        position: pos,\n      });\n      markersRef.current[it.id] = marker;\n\n      naver.maps.Event.addListener(marker, \"click\", () => {\n        onSelect?.(it.id);\n        map.panTo(pos);\n      });\n    });\n\n    if (items.length > 1) {\n      map.fitBounds(bounds, { top: 20, left: 20, right: 20, bottom: 20 });\n    }\n  }, [loaded, authFailed, items, onSelect]);\n\n  // 선택된 마커로 포커스\n  useEffect(() => {\n    if (!selectedId || !mapObj.current || !window.naver?.maps) return;\n    const marker = markersRef.current[selectedId];\n    if (!marker) return;\n    const pos = marker.getPosition();\n    mapObj.current.panTo(pos);\n    try {\n      marker.setAnimation(window.naver.maps.Animation.BOUNCE);\n      setTimeout(() => marker.setAnimation(null), 700);\n    } catch {}\n  }, [selectedId]);\n\n  return (\n    <div className=\"relative w-full h-64 rounded-2xl border border-neutral-200 overflow-hidden\">\n      <div ref={mapRef} className=\"w-full h-full\" />\n      {!loaded && (\n        <div className=\"absolute inset-0 flex items-center justify-center text-sm\">\n          지도를 불러오는 중…\n        </div>\n      )}\n      {authFailed && (\n        <div className=\"absolute inset-0 bg-white/85 backdrop-blur flex items-center justify-center p-4 text-xs\">\n          <div className=\"text-center\">\n            <div className=\"text-red-600 font-semibold mb-1\">\n              네이버 지도 인증 실패\n            </div>\n            <div className=\"text-neutral-700\">\n              Web 서비스 URL / ncpClientId 설정을 확인하세요.\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":"AAAA,4BAA4B;;;;;;AAI5B;AAHA;;;AAYA,iDAAiD;AACjD,MAAM,kBACJ,QAAQ,GAAG,CAAC,+BAA+B,IAAI;AAElC,SAAS,WAAW,EACjC,KAAK,EACL,UAAU,EACV,QAAQ,EAKT;IACC,MAAM,SAAS,IAAA,+MAAM,EAAwB;IAC7C,MAAM,SAAS,IAAA,+MAAM,EAAM;IAC3B,MAAM,aAAa,IAAA,+MAAM,EAAsB,CAAC;IAChD,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,iNAAQ,EAAC;IACrC,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,iNAAQ,EAAC;IAE7C,WAAW;IACX,IAAA,kNAAS,EAAC;QACR,wCAAmC;;;IAKrC,GAAG,EAAE;IAEL,SAAS;IACT,IAAA,kNAAS,EAAC;QACR,wCAAmC;;;QAKnC,MAAM;QACN,IAAI;QACJ,MAAM;IAcR,GAAG,EAAE;IAEL,QAAQ;IACR,IAAA,kNAAS,EAAC;QACR,IAAI,CAAC,UAAU,CAAC,OAAO,OAAO,IAAI,CAAC,OAAO,KAAK,EAAE,QAAQ,YAAY;QACrE,MAAM,EAAE,KAAK,EAAE,GAAG;QAElB,MAAM,QAAQ,KAAK,CAAC,EAAE;QACtB,MAAM,SAAS,QACX,IAAI,MAAM,IAAI,CAAC,MAAM,CAAC,MAAM,GAAG,EAAE,MAAM,GAAG,IAC1C,IAAI,MAAM,IAAI,CAAC,MAAM,CAAC,SAAS;QACnC,MAAM,MAAM,IAAI,MAAM,IAAI,CAAC,GAAG,CAAC,OAAO,OAAO,EAAE;YAC7C;YACA,MAAM;YACN,aAAa;YACb,oBAAoB;gBAAE,UAAU,MAAM,IAAI,CAAC,QAAQ,CAAC,SAAS;YAAC;QAChE;QACA,OAAO,OAAO,GAAG;QAEjB,WAAW;QACX,OAAO,MAAM,CAAC,WAAW,OAAO,EAAE,OAAO,CAAC,CAAC,IAAM,EAAE,MAAM,CAAC;QAC1D,WAAW,OAAO,GAAG,CAAC;QAEtB,QAAQ;QACR,MAAM,SAAS,IAAI,MAAM,IAAI,CAAC,YAAY;QAC1C,MAAM,OAAO,CAAC,CAAC;YACb,MAAM,MAAM,IAAI,MAAM,IAAI,CAAC,MAAM,CAAC,GAAG,GAAG,EAAE,GAAG,GAAG;YAChD,OAAO,MAAM,CAAC;YAEd,MAAM,SAAS,IAAI,MAAM,IAAI,CAAC,MAAM,CAAC;gBACnC;gBACA,UAAU;YACZ;YACA,WAAW,OAAO,CAAC,GAAG,EAAE,CAAC,GAAG;YAE5B,MAAM,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,QAAQ,SAAS;gBAC5C,WAAW,GAAG,EAAE;gBAChB,IAAI,KAAK,CAAC;YACZ;QACF;QAEA,IAAI,MAAM,MAAM,GAAG,GAAG;YACpB,IAAI,SAAS,CAAC,QAAQ;gBAAE,KAAK;gBAAI,MAAM;gBAAI,OAAO;gBAAI,QAAQ;YAAG;QACnE;IACF,GAAG;QAAC;QAAQ;QAAY;QAAO;KAAS;IAExC,cAAc;IACd,IAAA,kNAAS,EAAC;QACR,IAAI,CAAC,cAAc,CAAC,OAAO,OAAO,IAAI,CAAC,OAAO,KAAK,EAAE,MAAM;QAC3D,MAAM,SAAS,WAAW,OAAO,CAAC,WAAW;QAC7C,IAAI,CAAC,QAAQ;QACb,MAAM,MAAM,OAAO,WAAW;QAC9B,OAAO,OAAO,CAAC,KAAK,CAAC;QACrB,IAAI;YACF,OAAO,YAAY,CAAC,OAAO,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,MAAM;YACtD,WAAW,IAAM,OAAO,YAAY,CAAC,OAAO;QAC9C,EAAE,OAAM,CAAC;IACX,GAAG;QAAC;KAAW;IAEf,qBACE,8OAAC;QAAI,WAAU;;0BACb,8OAAC;gBAAI,KAAK;gBAAQ,WAAU;;;;;;YAC3B,CAAC,wBACA,8OAAC;gBAAI,WAAU;0BAA4D;;;;;;YAI5E,4BACC,8OAAC;gBAAI,WAAU;0BACb,cAAA,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BAAI,WAAU;sCAAkC;;;;;;sCAGjD,8OAAC;4BAAI,WAAU;sCAAmB;;;;;;;;;;;;;;;;;;;;;;;AAQ9C","debugId":null}},
    {"offset": {"line": 160, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/sanghojeong/Desktop/Projects/%EA%B6%8C%EB%A6%AC%EA%B8%88%EC%A4%91%EA%B0%9C%EC%95%B1/my-shop-transfer-app-1.2/components/ProofUpload.tsx"],"sourcesContent":["// components/ProofUpload.tsx\n\"use client\";\n\nimport { useState } from \"react\";\n\nexport default function ProofUpload({\n  listingId,\n  defaultStatus = \"unverified\",\n}: {\n  listingId: number;\n  defaultStatus?: \"verified\" | \"unverified\";\n}) {\n  const [files, setFiles] = useState<FileList | null>(null);\n  const [busy, setBusy] = useState(false);\n  const [msg, setMsg] = useState<string | null>(null);\n\n  const onSubmit = async () => {\n    if (!files || files.length === 0) {\n      setMsg(\"파일을 선택해 주세요.\");\n      return;\n    }\n    setBusy(true);\n    setMsg(null);\n    try {\n      // 데모: 실제 업로드 대신 /api/leads 로 이벤트 남김\n      const meta = Array.from(files).map((f) => ({\n        name: f.name,\n        size: f.size,\n        type: f.type,\n      }));\n      const res = await fetch(\"/api/leads\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          type: \"listing\",\n          listingId,\n          name: \"증빙 업로드\",\n          phone: \"-\",\n          payload: { kind: \"proof_upload\", files: meta, status: defaultStatus },\n        }),\n      });\n      const data = await res.json();\n      if (!res.ok) throw new Error(data?.error || \"업로드 요청 실패\");\n      setMsg(\"업로드 요청이 접수되었습니다. (데모)\");\n      setFiles(null);\n    } catch (e: any) {\n      setMsg(e?.message || \"업로드 요청 실패\");\n    } finally {\n      setBusy(false);\n    }\n  };\n\n  return (\n    <div className=\"flex items-center gap-2\">\n      <label className=\"text-xs text-neutral-600\">증빙 업로드</label>\n      <input\n        type=\"file\"\n        multiple\n        className=\"text-xs\"\n        onChange={(e) => setFiles(e.target.files)}\n      />\n      <button\n        onClick={onSubmit}\n        disabled={busy}\n        className=\"rounded-md border px-2 py-1 text-xs hover:bg-neutral-50 disabled:opacity-60\"\n      >\n        {busy ? \"처리 중…\" : \"업로드\"}\n      </button>\n      {msg && <span className=\"text-xs text-neutral-500\">{msg}</span>}\n    </div>\n  );\n}\n"],"names":[],"mappings":"AAAA,6BAA6B;;;;;;AAG7B;AAFA;;;AAIe,SAAS,YAAY,EAClC,SAAS,EACT,gBAAgB,YAAY,EAI7B;IACC,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,iNAAQ,EAAkB;IACpD,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,iNAAQ,EAAC;IACjC,MAAM,CAAC,KAAK,OAAO,GAAG,IAAA,iNAAQ,EAAgB;IAE9C,MAAM,WAAW;QACf,IAAI,CAAC,SAAS,MAAM,MAAM,KAAK,GAAG;YAChC,OAAO;YACP;QACF;QACA,QAAQ;QACR,OAAO;QACP,IAAI;YACF,oCAAoC;YACpC,MAAM,OAAO,MAAM,IAAI,CAAC,OAAO,GAAG,CAAC,CAAC,IAAM,CAAC;oBACzC,MAAM,EAAE,IAAI;oBACZ,MAAM,EAAE,IAAI;oBACZ,MAAM,EAAE,IAAI;gBACd,CAAC;YACD,MAAM,MAAM,MAAM,MAAM,cAAc;gBACpC,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;gBAC9C,MAAM,KAAK,SAAS,CAAC;oBACnB,MAAM;oBACN;oBACA,MAAM;oBACN,OAAO;oBACP,SAAS;wBAAE,MAAM;wBAAgB,OAAO;wBAAM,QAAQ;oBAAc;gBACtE;YACF;YACA,MAAM,OAAO,MAAM,IAAI,IAAI;YAC3B,IAAI,CAAC,IAAI,EAAE,EAAE,MAAM,IAAI,MAAM,MAAM,SAAS;YAC5C,OAAO;YACP,SAAS;QACX,EAAE,OAAO,GAAQ;YACf,OAAO,GAAG,WAAW;QACvB,SAAU;YACR,QAAQ;QACV;IACF;IAEA,qBACE,8OAAC;QAAI,WAAU;;0BACb,8OAAC;gBAAM,WAAU;0BAA2B;;;;;;0BAC5C,8OAAC;gBACC,MAAK;gBACL,QAAQ;gBACR,WAAU;gBACV,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK;;;;;;0BAE1C,8OAAC;gBACC,SAAS;gBACT,UAAU;gBACV,WAAU;0BAET,OAAO,UAAU;;;;;;YAEnB,qBAAO,8OAAC;gBAAK,WAAU;0BAA4B;;;;;;;;;;;;AAG1D","debugId":null}}]
}